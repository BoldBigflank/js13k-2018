<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>JS13k - Close to me</title>
</head>

<body>
    <h1>Close to Me</h1>
    <canvas id="game" width=1280 height=720></canvas>
<script type="text/javascript">!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){var i,r,o;r=[e],void 0===(o="function"==typeof(i=function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),n=/^[0-9.]+$/,i=/\s+/,r=/(\d+)/,o={};function s(t){var e=t.split(i);this.frequency=s.getFrequency(e[0])||0,this.duration=s.getDuration(e[1])||0}function a(t,e,n){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,n||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){o[t]=e})}),s.getFrequency=function(t){var n=t.split(r),i=o[n[0]],s=(n[1]||4)-4,a=e*Math.pow(Math.pow(2,1/12),i);return a*Math.pow(2,s)},s.getDuration=function(t){return n.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},a.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,n){(n=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",n.frequency.value=e[1],t.connect(t=n)}.bind(this)),t.connect(this.ac.destination),this},a.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof s?t:new s(t))}.bind(this)),this},a.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},a.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},a.prototype.scheduleNote=function(t,e){var n=60/this.tempo*this.notes[t].duration,i=n*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+n},a.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},a.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},a.prototype.slide=function(t,e,n){var i=this.getNextNote(t),r=this.getSlideStartDelay(n);return this.setFrequency(this.notes[t].frequency,e+r),this.rampFrequency(i.frequency,e+n),this},a.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},a.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},a.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,n){t=this.scheduleNote(n,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},a.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=s,t.Sequence=a})?i.apply(e,r):i)||(t.exports=o)},function(t,e,n){"use strict";n.r(e);n(2),n(7);var i=n(0),r=128;function o(t){return t/r*60*60}function s(t){return t*Math.PI/180}function a(t,e,n,i){return function(t,e,n){return t*(1-n)+e*n}(t,e,1-Math.exp(-n*i))}for(var h=new AudioContext,c=(h.currentTime,["- 4"]),u=["F3 ","Ab3 ","F4 ","Ab4 ","F5 ","Ab5 ","F5 ","Ab4 ","F4 ","Ab3 "],d=[],l=[],p={type:"enemy",width:35,height:90,color:"#909",ttl:1/0,x:640,y:360,rotation:0,ticks:0,collidesWith:function(t){if(!function(t){var e=this.radius||this.height/2,n=this.x-t.x,i=this.y-t.y;return Math.sqrt(n*n+i*i)<e+t.radius}.call(this,t))return!1;var e=Math.cos(s(this.rotation))/Math.sin(s(this.rotation)),n=-1*(e*this.x+this.y),i=t.x,r=t.y;return Math.abs(e*i+1*r+n)/Math.sqrt(e*e+1)<this.width/2+t.radius},update:function(t){this.ticks++,this.rotation+=this.ticks>o(36)?64/r:64/r/2,this.height+=2.1,this.ticks>o(4)&&(this.height=1800),this.advance()},render:function(){this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(s(this.rotation)),this.context.fillRect(-1*this.width/2,-this.height/2,this.width,this.height),this.context.restore()}},f=kontra.sprite({tears:[],type:"factory",ttl:1/0,start:function(){this.tears=b.notes.map(function(t){return 60*t.duration/r}),d.push(this)},update:function(t){for(this.tears[0]-=t;this.tears.length&&this.tears[0]<=0;){for(var e=-1;e<2;e+=2){var n=kontra.sprite({type:"enemy",width:12,height:12,color:"#909",dx:e*(6*Math.random()+3),ddy:.3,x:30*e+kontra.canvas.width/2-6,y:kontra.canvas.height/2-6,ttl:49,update:function(t){this.advance()}});l.push(n)}var i=this.tears.shift();this.tears[0]-=i,k.width+=20*Math.random()+20,k.height+=20*Math.random()+20}}}),y=0;y<440;y++){var v=360*Math.log10((y+1+7.291)/7.291),m=u[y%u.length]+r/v;c.push(m)}var x=new i.Sequence(h,r,["F4 128"]),b=new i.Sequence(h,r,c),g=new i.Sequence(h,r,["- 32","F2 8","Eb2 8","Bb1 8","Db2 8","F2 8","Eb2 8","Bb1 8","Db2 8","F2 8","Eb2 8","Bb1 8","Db2 8"]);b.staccato=.55,x.gain.gain.value=.05,b.gain.gain.value=.1,g.gain.gain.value=.05,x.createCustomWave([1,.11,.88,.55,.77,.33,.33,.33,.44,.11,.22]),b.waveType="triangle",g.loop=!1,x.loop=!1,b.loop=!1,kontra.init();var w=kontra.sprite({x:80,y:80,width:12,height:12,radius:6,rotation:0,ttl:1/0,dashFrames:0,iFrames:0,stunFrames:0,color:"yellow",update:function(t){if(this.stunFrames>0)this.stunFrames--,this.rotation+=4;else if(this.dx=this.dy=0,kontra.keys.pressed("w")&&(this.dy+=-3),kontra.keys.pressed("s")&&(this.dy+=3),kontra.keys.pressed("a")&&(this.dx+=-3),kontra.keys.pressed("d")&&(this.dx+=3),this.dx&&this.dy&&(this.dx*=.707,this.dy*=.707),this.dy||this.dx){this.rotation=180*Math.atan2(this.dy,this.dx)/Math.PI;for(var e=0;e<this.dashFrames/10+1;e++){var n=kontra.sprite({type:"particle",x:this.x,y:this.y,dx:-1*this.dx+4*Math.random()-2,dy:-1*this.dy+4*Math.random()-2,ttl:8,width:2,height:2,color:"white",update:function(t){this.advance()}});l.push(n)}}this.dashFrames>0&&(this.dx*=(Math.pow(this.dashFrames,2)+120)/120,this.dy*=(Math.pow(this.dashFrames,2)+120)/120,this.dashFrames--),this.iFrames>0&&this.iFrames--,this.advance()},render:function(){this.context.save(),this.context.strokeStyle="yellow",this.context.fillStyle="yellow",this.context.translate(this.x,this.y),this.context.rotate(s(this.rotation)),this.context.beginPath(),this.context.moveTo(-6,-6),this.context.lineTo(12,0),this.context.lineTo(-6,6),this.context.closePath(),this.context.stroke(),this.context.fill(),this.context.restore()}});l.push(w);var k=kontra.sprite({x:kontra.canvas.width/2-60,y:kontra.canvas.height/2-60,type:"enemy",width:120,height:120,ttl:1/0,color:"#909",update:function(t){this.width=a(this.width,120,12,t),this.height=a(this.height,120,12,t),this.x=(kontra.canvas.width-this.width)/2,this.y=(kontra.canvas.height-this.height)/2,this.advance()}});l.push(k);var F=kontra.gameLoop({fps:r/60,render:function(){},clearCanvas:!1,update:function(t){void 0===this.beat&&(this.beat=-1),this.beat++,console.log("beat "+Math.floor(1+this.beat/4)+"-"+Math.floor(1+this.beat%4)+" ("+this.beat+")"),0===this.beat&&(f.start(),x.play(),b.play(),g.play()),28!=this.beat&&36!==this.beat&&44!==this.beat&&52!==this.beat||l.push(kontra.sprite(p))}}),M=kontra.gameLoop({update:function(t){d.map(function(e){e.update(t)}),d=d.filter(function(t){return t.isAlive()}),l.map(function(e){if(e.update(t),e.x=(e.x+kontra.canvas.width)%kontra.canvas.width,e.y=(e.y+kontra.canvas.height)%kontra.canvas.height,!w.iFrames&&"enemy"===e.type&&e.collidesWith(w)){w.stunFrames=45,w.iFrames=60;var n=2*Math.random()*Math.PI;w.dx=8*Math.cos(n),w.dy=8*Math.sin(n)}}),l=l.filter(function(t){return t.isAlive()})},render:function(){l.map(function(t){return t.render()})}});kontra.keys.bind("space",function(){this.dashFrames>0||this.stunFrames>0||(this.dashFrames=30,this.iFrames=30,M.isStopped&&S())}.bind(w));var S=function(){M.start(),F.beat=-1,F.start()}},function(t,e,n){var i=n(3);"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(5)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(4)(!1)).push([t.i,"* {\r\n    box-sizing:border-box;\r\n}\r\n\r\nbody {\r\n    color:white;\r\n    background-color:#303;\r\n    overflow:hidden;\r\n    margin:0;\r\n    text-align:center;\r\n}\r\n\r\ncanvas {\r\n    background-color:#101;\r\n    border: 8px solid #f0f;\r\n    width:100%;\r\n    max-width:1280px;\r\n    margin:0px auto;\r\n}\r\n",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(i),o=i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"});return[n].concat(o).concat([r]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(i[o]=!0)}for(r=0;r<t.length;r++){var s=t[r];"number"==typeof s[0]&&i[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),e.push(s))}},e}},function(t,e,n){var i={},r=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),o=function(t){var e={};return function(t,n){if("function"==typeof t)return t();if(void 0===e[t]){var i=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}}(),s=null,a=0,h=[],c=n(6);function u(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=i[r.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](r.parts[s]);for(;s<r.parts.length;s++)o.parts.push(v(r.parts[s],e))}else{var a=[];for(s=0;s<r.parts.length;s++)a.push(v(r.parts[s],e));i[r.id]={id:r.id,refs:1,parts:a}}}}function d(t,e){for(var n=[],i={},r=0;r<t.length;r++){var o=t[r],s=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function l(t,e){var n=o(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=h[h.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),h.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=o(t.insertAt.before,n);n.insertBefore(e,r)}}function p(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=h.indexOf(t);e>=0&&h.splice(e,1)}function f(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var i=function(){0;return n.nc}();i&&(t.attrs.nonce=i)}return y(e,t.attrs),l(t,e),e}function y(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function v(t,e){var n,i,r,o;if(e.transform&&t.css){if(!(o=e.transform(t.css)))return function(){};t.css=o}if(e.singleton){var h=a++;n=s||(s=f(e)),i=x.bind(null,n,h,!1),r=x.bind(null,n,h,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",y(e,t.attrs),l(t,e),e}(e),i=function(t,e,n){var i=n.css,r=n.sourceMap,o=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||o)&&(i=c(i));r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var s=new Blob([i],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}.bind(null,n,e),r=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=f(e),i=function(t,e){var n=e.css,i=e.media;i&&t.setAttribute("media",i);if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,n),r=function(){p(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=d(t,e);return u(n,e),function(t){for(var r=[],o=0;o<n.length;o++){var s=n[o];(a=i[s.id]).refs--,r.push(a)}t&&u(d(t,e),e);for(o=0;o<r.length;o++){var a;if(0===(a=r[o]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete i[a.id]}}}};var m=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}();function x(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=m(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var r,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(r=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(t,e,n){n(8)(n(9))},function(t,e){t.exports=function(t){function e(t){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",t)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(t):"undefined"!=typeof eval?eval.call(null,t):e("EvalError: No eval function available")}catch(t){e(t)}}},function(t,e){t.exports='/*\n * Kontra.js v4.0.0 (Custom Build on 2018-08-15) | MIT\n * Build: https://straker.github.io/kontra/download?files=gameLoop+keyboard+sprite\n */\nthis.kontra={init(t){var n=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=n.getContext("2d")},_noop:new Function,_tick:new Function};\nkontra.gameLoop=function(e){let t,n,a,r,o=(e=e||{}).fps||60,i=0,p=1e3/o,c=1/o,s=!1===e.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function d(){if(n=requestAnimationFrame(d),a=performance.now(),r=a-t,t=a,!(r>1e3)){for(kontra._tick(),i+=r;i>=p;)m.update(c),i-=p;s(),m.render()}}let m={update:e.update,render:e.render,isStopped:!0,start(){t=performance.now(),this.isStopped=!1,requestAnimationFrame(d)},stop(){this.isStopped=!0,cancelAnimationFrame(n)}};return m};\n!function(){let n={},t={},e={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let n=0;n<26;n++)e[65+n]=(10+n).toString(36);for(i=0;i<10;i++)e[48+i]=""+i;addEventListener("keydown",function(i){let c=e[i.which];t[c]=!0,n[c]&&n[c](i)}),addEventListener("keyup",function(n){t[e[n.which]]=!1}),addEventListener("blur",function(n){t={}}),kontra.keys={bind(t,e){[].concat(t).map(function(t){n[t]=e})},unbind(t,e){[].concat(t).map(function(t){n[t]=e})},pressed:n=>!!t[n]}}();\n!function(){class t{constructor(t,i){this._x=t||0,this._y=i||0}add(t,i){this.x+=(t.x||0)*(i||1),this.y+=(t.y||0)*(i||1)}clamp(t,i,h,s){this._c=!0,this._a=t,this._b=i,this._d=h,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=((i,h)=>new t(i,h)),kontra.vector.prototype=t.prototype;class i{init(t,i,h,s){for(i in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[i]=t[i];if(h=t.image)this.image=h,this.width=h.width,this.height=h.height;else if(h=t.animations){for(i in h)this.animations[i]=h[i].clone(),s=s||h[i];this._ca=s,this.width=s.width,this.height=s.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=(t=>(new i).init(t)),kontra.sprite.prototype=i.prototype}();'}]);</script></body>
</html>